{% extends 'base.html' %}
{% block content %}
<div class="container-fluid px-3 px-sm-4">
<h1>Auth Logs (Admin)</h1>
<div class="d-flex align-items-center mb-3">
  <button class="btn btn-sm btn-outline-primary me-2" id="refresh">Refresh</button>
  <span class="ms-3 small text-muted">Showing last 100 logs</span>
</div>
<div id="logsTable"></div>
<script>
let logs = {{ logs | tojson }};

function render() {
  const container = document.getElementById('logsTable');
  container.innerHTML = '';
  if (!logs.length) { container.innerHTML = '<div class="alert alert-info">No logs yet.</div>'; return; }

  const table = document.createElement('table');
  table.className = 'table table-sm table-striped';
  table.innerHTML = '<thead><tr><th>Timestamp</th><th>Event</th><th>Username</th><th>IP</th><th>User-Agent</th><th>Details</th></tr></thead>';
  const tbody = document.createElement('tbody');
  logs.forEach(l => {
    const tr = document.createElement('tr');
    const timestamp = new Date(l.timestamp).toLocaleString();
    tr.innerHTML = `<td>${timestamp}</td><td>${l.event}</td><td>${l.username}</td><td>${l.ip}</td><td>${l.user_agent || ''}</td><td>${l.details || ''}</td>`;
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  container.appendChild(table);
}

document.getElementById('refresh').addEventListener('click', () => location.reload());

render();
</script>
</div>
{% endblock %}
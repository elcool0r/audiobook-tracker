<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page_title or 'Admin - Audiobook Tracker' }}</title>
    <link rel="icon" type="image/svg+xml" href="{{ base_path }}/static/favicon/favicon.svg">
    <link rel="alternate icon" href="{{ base_path }}/static/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="96x96" href="{{ base_path }}/static/favicon/favicon-96x96.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="{{ brand_title or 'Audiobook Tracker' }}">
    <meta name="theme-color" content="#101010">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="{{ base_path }}/static/css/custom.css" rel="stylesheet">
  </head>
  <body>
    <script>
      window.BASE_PATH = "{{ base_path }}";
      window.apiPath = (p) => `${window.BASE_PATH || ''}${p}`;
    </script>
    {% if not hide_nav %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="{{ (base_path ~ '/library') if not public_nav else '#' }}">{{ brand_title or 'Audiobook Tracker' }}</a>
        <span class="navbar-text small text-muted ms-2">{{ version }}</span>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto align-items-center">
            {% if not public_nav %}
              {% if user %}
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/library">Library</a></li>
              {% endif %}
              {% if user and user.role == 'admin' %}
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/series-admin">Series</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/users">Users</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/jobs">Jobs</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/settings">Settings</a></li>
              {% endif %}
              {% if settings.developer_mode and user and user.role == 'admin' %}
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/logs">Logs</a></li>
              {% endif %}
              {% if user %}
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/profile">Profile</a></li>
              {% endif %}
              {% if user %}
              <li class="nav-item"><a class="nav-link" href="/home/{{ user.frontpage_slug or user.username }}" title="Public Page" target="_blank">üåê</a></li>
              {% endif %}
            {% endif %}
            <li class="nav-item">
              <a class="nav-link" href="#" id="darkModeToggle" title="Toggle dark mode">
                <span id="darkModeIcon">‚òÄÔ∏è</span>
              </a>
            </li>
            {% if not public_nav %}
              {% if settings.developer_mode and user and user.role == 'admin' %}
              <li class="nav-item ms-2"><a class="nav-link" href="{{ base_path }}/docs" target="_blank">API Docs</a></li>
              {% endif %}
              {% if user %}
              <li class="nav-item"><a class="nav-link" href="{{ base_path }}/logout">Logout</a></li>
              {% endif %}
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    {% endif %}
    <main class="{{ main_class or 'container' }} py-4">
      {% block content %}{% endblock %}
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Dark mode toggle
      const htmlEl = document.documentElement;
      const toggleBtn = document.getElementById('darkModeToggle');
      const icon = document.getElementById('darkModeIcon');
      
      // Load saved preference or default to dark
      const savedTheme = localStorage.getItem('theme') || 'dark';
      htmlEl.setAttribute('data-bs-theme', savedTheme);
      updateIcon(savedTheme);
      
      if (toggleBtn) {
        toggleBtn.addEventListener('click', (e) => {
          e.preventDefault();
          const currentTheme = htmlEl.getAttribute('data-bs-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          htmlEl.setAttribute('data-bs-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          updateIcon(newTheme);
        });
      }
      
      function updateIcon(theme) {
        if (!icon) {
          return;
        }
        icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
    </script>
  </body>
</html>
